<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Concrete Calculator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&family=Noto+Sans:wght@400;500;700&family=Hind:wght@400;500;700&display=swap');
        
        :root {
            --primary-color: #2a6fdb; --primary-dark: #1e5abc; --secondary-color: #333; --background-color: #f4f7f6;
            --card-bg: #ffffff; --text-color: #333; --border-color: #e1e1e1;
            --success-color: #28a745; --danger-color: #dc3545; --warning-color: #ffc107; --info-bg: #e9f2ff;
            --shadow-color: rgba(0,0,0,0.1); --icon-color: #666;
        }

        html.dark-mode {
            --primary-color: #589bff; --primary-dark: #2a6fdb; --secondary-color: #e0e0e0; --background-color: #121212;
            --card-bg: #1e1e1e; --text-color: #e0e0e0; --border-color: #444;
            --info-bg: #2a3a50; --shadow-color: rgba(0,0,0,0.4); --icon-color: #aaa;
        }
        
        body { font-family: 'Roboto', 'Noto Sans', 'Hind', 'Noto Sans SC', sans-serif; background-color: var(--background-color); color: var(--text-color); margin: 0; padding: 20px; transition: background-color 0.3s, color 0.3s; }
        .main-container { max-width: 650px; margin: 40px auto; background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 20px var(--shadow-color); overflow: hidden; }
        .app-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; background: var(--secondary-color); color: var(--card-bg); text-align: center; }
        .app-header h1 { margin: 0; font-size: 1.8em; flex-grow: 1; }
        .header-icon { background: none; border: none; color: var(--card-bg); font-size: 1.5em; cursor: pointer; opacity: 0.8; transition: opacity 0.2s; }
        .header-icon:hover { opacity: 1; }
        .language-selector { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; padding: 15px; background: var(--info-bg); border-bottom: 1px solid var(--border-color); }
        .lang-button { background: transparent; border: 1px solid var(--border-color); color: var(--text-color); padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; }
        .lang-button.selected { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .app-body { padding: 25px; }
        .navigation-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 25px; }
        .nav-button { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 12px; background: var(--card-bg); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 8px; cursor: pointer; text-align: center; font-weight: 500; transition: all 0.2s; }
        .nav-button span { font-size: 0.9em; line-height: 1.2; }
        .nav-button svg { width: 32px; height: 32px; fill: var(--icon-color); transition: fill 0.2s; }
        .nav-button.active { background: var(--primary-color); color: white; border-color: var(--primary-dark); }
        .nav-button.active svg { fill: white; }
        #running-totals-bar { display: none; justify-content: space-between; align-items: center; padding: 12px 15px; background: var(--info-bg); border: 1px solid var(--primary-color); border-radius: 8px; margin-bottom: 25px; font-size: 0.9em; position: sticky; top: 10px; z-index: 100; box-shadow: 0 2px 5px var(--shadow-color); }
        .app-view { display: none; animation: fadeIn 0.5s; }
        .app-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .form-group, .results-container, .settings-panel { border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 20px; }
        .form-inputs { padding: 15px; }
        .form-row { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
        .form-row:last-child { border-bottom: none; }
        .form-row-2-col { display: flex; flex-wrap: wrap; gap: 15px; }
        .form-row-2-col .form-row { flex: 1 1 250px; padding: 8px 0; }
        .input-group { display: flex; align-items: center; gap: 8px; }
        .input-group.feet-inches { gap: 4px; }
        .input-group input { width: 80px; text-align: right; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 16px; background-color: var(--background-color); color: var(--text-color); }
        .input-group.feet-inches input { width: 60px; }
        .unit { color: var(--icon-color); }
        .action-button { width: 100%; padding: 15px; font-size: 1.1em; font-weight: 700; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px; transition: background-color 0.2s; }
        .calculate-button { background-color: var(--primary-color); }
        .calculate-button:hover { background-color: var(--primary-dark); }
        .add-to-project-button { background-color: var(--success-color); }
        .error-message { color: var(--danger-color); text-align: center; margin-top: 10px; font-weight: 500; min-height: 1.2em; }
        .results-container { padding: 15px; }
        .results-container h3, #project-summary h2, .settings-panel summary { text-align: center; margin-top: 0; color: var(--primary-color); font-weight: 500;}
        .result-item { text-align: center; padding: 10px; flex-grow: 1; }
        .result-item .value { font-size: 2em; font-weight: 700; color: var(--primary-color); }
        .result-split { display: flex; justify-content: space-around; border-top: 1px solid var(--border-color); margin-top: 10px; }
        .item-name-group { margin-top: 15px; }
        .item-name-group input { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background-color: var(--background-color); color: var(--text-color); box-sizing: border-box; }
        details.settings-panel { padding: 0; }
        details summary { padding: 15px; cursor: pointer; font-weight: bold; font-size: 1.2em; list-style: none; }
        details summary::-webkit-details-marker { display: none; }
        .settings-content { padding: 0 15px 15px; }
        #project-summary-container { border-top: 2px solid var(--secondary-color); margin-top: 40px; padding-top: 25px; }
        #project-summary ul { list-style: none; padding: 0; }
        #project-summary li { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; padding: 12px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 10px; transition: background-color 0.2s; }
        #project-summary li:hover { background-color: var(--info-bg); }
        .project-item-details { flex-grow: 1; margin-right: 15px; }
        .project-item-name { font-weight: bold; font-size: 1.1em; }
        .project-item-cost { font-size: 1.1em; font-weight: bold; color: var(--primary-color); text-align: right; }
        .project-item-cost .volume { font-size: 0.8em; font-weight: normal; color: var(--icon-color); }
        .remove-item-btn { background: var(--danger-color); color: white; border: none; border-radius: 50%; width: 26px; height: 26px; font-weight: bold; cursor: pointer; flex-shrink: 0; margin-left: 15px;}
        .project-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 200; display: none; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .modal-content { background: var(--card-bg); color: var(--text-color); padding: 30px; border-radius: 8px; max-width: 500px; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-close { position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--icon-color); }
        #instructions-modal ul { list-style: disc; padding-left: 20px; line-height: 1.6; }
        
        @media (max-width: 600px) {
            body { padding: 0; }
            .main-container { margin: 0; border-radius: 0; }
            .app-body { padding: 15px; }
            #running-totals-bar { top: 0; border-radius: 0; }
            input[type="text"], input[type="number"], textarea, select { font-size: 16px !important; }
            .navigation-grid { grid-template-columns: repeat(auto-fit, minmax(95px, 1fr)); gap: 8px; }
            .form-row-2-col { flex-direction: column; gap: 0; }
        }

        @media print {
            body { padding: 20px; background-color: #fff; color: #000; }
            .no-print, .main-container > *:not(.print-area) { display: none !important; }
            .print-area { display: block !important; box-shadow: none; border: none; padding: 0; }
            html, body, .main-container { all: initial; font-family: 'Roboto', sans-serif; }
            #project-summary-container ul li { border: 1px solid #ccc; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <header class="app-header no-print">
            <button id="theme-toggle" class="header-icon">‚òÄÔ∏è</button>
            <h1 data-translate-key="app_title"></h1>
            <button id="instructions-btn" class="header-icon">?</button>
        </header>

        <section class="language-selector no-print">
            <button class="lang-button" data-lang="en">English</button>
            <button class="lang-button" data-lang="es">Espa√±ol</button>
            <button class="lang-button" data-lang="zh">‰∏≠Êñá</button>
            <button class="lang-button" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
        </section>
        
        <main class="app-body">
            <div id="calculator-section" class="no-print">
                <details class="settings-panel" open>
                    <summary data-translate-key="settings_title"></summary>
                    <div class="settings-content">
                         <div class="form-row"><span data-translate-key="waste_factor"></span><div class="input-group"><input type="number" id="waste-factor" min="0" step="1"><span class="unit">%</span></div></div>
                         <div class="form-row"><span data-translate-key="cost_yard"></span><div class="input-group"><span class="unit">$</span><input type="number" id="cost-yard" min="0" step="0.01"></div></div>
                         <div class="form-row"><span data-translate-key="cost_80lb"></span><div class="input-group"><span class="unit">$</span><input type="number" id="cost-80lb" min="0" step="0.01"></div></div>
                         <div class="form-row"><span data-translate-key="cost_60lb"></span><div class="input-group"><span class="unit">$</span><input type="number" id="cost-60lb" min="0" step="0.01"></div></div>
                    </div>
                </details>

                <nav id="navigation-grid" class="navigation-grid"></nav>
                <div id="running-totals-bar">
                    <span id="running-totals-text"></span><strong><span id="running-yards"></span> yd¬≥</strong>
                </div>
                <div id="view-container"></div>
            </div>

            <div id="project-summary-container" class="print-area"></div>
        </main>
    </div>

    <!-- MODAL FOR INSTRUCTIONS -->
    <div id="instructions-modal" class="modal-overlay no-print">
        <div class="modal-content">
            <button class="modal-close">√ó</button>
            <h2 data-translate-key="instructions_title"></h2>
            <ul data-translate-list="instructions"></ul>
        </div>
    </div>
    
    <!-- TEMPLATE FOR CALCULATOR VIEWS -->
    <template id="calculator-view-template">
        <div class="app-view form-group">
            <div class="form-inputs"></div>
            <button class="action-button calculate-button" data-translate-key="calculate_button"></button>
            <div class="error-message"></div>
            <div class="results-container" style="display:none;"></div>
        </div>
    </template>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CONSTANTS AND STATE ---
    const CUBIC_FEET_IN_YARD = 27, BAG_80LB_YIELD = 0.60, BAG_60LB_YIELD = 0.45, PI = Math.PI;
    const DOM = {
        viewContainer: document.getElementById('view-container'), navGrid: document.getElementById('navigation-grid'),
        projectSummaryContainer: document.getElementById('project-summary-container'), runningTotalsBar: document.getElementById('running-totals-bar'),
        themeToggle: document.getElementById('theme-toggle'), instructionsBtn: document.getElementById('instructions-btn'),
        instructionsModal: document.getElementById('instructions-modal'), modalClose: document.querySelector('.modal-close'),
        wasteFactorInput: document.getElementById('waste-factor'), costYardInput: document.getElementById('cost-yard'),
        cost80lbInput: document.getElementById('cost-80lb'), cost60lbInput: document.getElementById('cost-60lb'),
    };
    
    let state = {
        lang: 'en', projectItems: [],
        settings: { waste: 5, costYard: 175.00, cost80lb: 6.50, cost60lb: 5.25 },
        ui: { activeView: 'slab-footing', isDark: window.matchMedia('(prefers-color-scheme: dark)').matches },
        latestCalcResults: {}
    };

    const translations = {
        en: { app_title: "Pro Concrete Calculator", settings_title: "Project Settings & Costs", waste_factor: "Waste Factor", cost_yard: "Cost per yd¬≥ (Truck)", cost_80lb: "Cost per 80lb Bag", cost_60lb: "Cost per 60lb Bag", clear_button: "Clear Project", print_button: "Print", copy_button: "Copy Text", copied_button: "Copied!", slab_footing_title: "Slab / Footing", column_title: "Column / Post Hole", circ_slab_title: "Circular Slab", stairs_title: "Stairs", tube_bell_title: "Tube w/ Bell Footing", trapezoid_footing_title: "Trapezoid Footing", project_title: "Project Summary", instructions_title: "How to Use", calculate_button: "Calculate", total_needed: "Piece Total", grand_total: "Grand Total", item_name: "Item Name (optional)", cubic_yards: "Cubic Yards", bags80: "80lb Bags", bags60: "60lb Bags", add_to_project: "Add to Project", running_total_text: (n) => `Project: ${n} items`, length: "Length", width: "Width", thickness: "Thickness", diameter: "Diameter", depth_height: "Depth / Height", num_steps: "Number of Steps", tread_depth: "Tread Depth", riser_height: "Riser Height", stair_width: "Stair Width", waist_thick: "Waist/Slab Thickness", tube_diameter: "Tube Diameter", bell_diameter: "Bell Diameter", bell_thickness: "Bell Thickness", top_width: "Top Width", bottom_width: "Bottom Width", feet: "ft", inches: "in", project_empty: "Your project is empty. Add items from a calculator to see them here.", error_invalid_input: "Please enter valid, positive numbers in all fields.", cost: "Cost", instructions: [ "Adjust the Waste Factor and Material Costs in the Settings panel.", "Click an icon to choose the calculator for your shape (e.g., Slab, Column).", "Enter dimensions. You can use both feet and inches fields for length/width/depth.", "Click 'Calculate' to see the required concrete for that single piece.", "Give the piece a name (like 'Patio') and click 'Add to Project'.", "Your complete project list and grand totals are shown at the bottom.", "Use the 'Copy' or 'Print' buttons for a portable summary."]},
        es: { app_title: "Calculadora Pro de Concreto", settings_title: "Ajustes y Costos", waste_factor: "Factor de Desperdicio", cost_yard: "Costo por yd¬≥", cost_80lb: "Costo por Bolsa 80lb", cost_60lb: "Costo por Bolsa 60lb", clear_button: "Limpiar Proyecto", print_button: "Imprimir", copy_button: "Copiar Texto", copied_button: "¬°Copiado!", slab_footing_title: "Losa / Zapata", column_title: "Columna / Hoyo", circ_slab_title: "Losa Circular", stairs_title: "Escaleras", tube_bell_title: "Base c/ Campana", trapezoid_footing_title: "Zapata Trapezoidal", project_title: "Resumen del Proyecto", instructions_title: "Instrucciones", calculate_button: "Calcular", total_needed: "Total de Pieza", grand_total: "Total General", item_name: "Nombre (opcional)", cubic_yards: "Yardas C√∫bicas", bags80: "Bolsas de 80lb", bags60: "Bolsas de 60lb", add_to_project: "A√±adir al Proyecto", running_total_text: (n) => `Proyecto: ${n} piezas`, length: "Longitud", width: "Ancho", thickness: "Espesor", diameter: "Di√°metro", depth_height: "Profundidad", num_steps: "N¬∫ de Escalones", tread_depth: "Huella", riser_height: "Contrahuella", stair_width: "Ancho Escalera", waist_thick: "Espesor Losa", tube_diameter: "Di√°metro Tubo", bell_diameter: "Di√°metro Campana", bell_thickness: "Espesor Campana", top_width: "Ancho Superior", bottom_width: "Ancho Inferior", feet: "ft", inches: "in", project_empty: "Su proyecto est√° vac√≠o.", error_invalid_input: "Por favor, ingrese n√∫meros v√°lidos y positivos.", cost: "Costo", instructions: [ "Ajuste el Factor de Desperdicio y Costos en el panel de Ajustes.", "Haga clic en un icono para elegir la calculadora para su forma.", "Ingrese las dimensiones. Puede usar campos de pies y pulgadas.", "Haga clic en 'Calcular' para ver el concreto requerido para esa pieza.", "D√©le un nombre a la pieza y haga clic en 'A√±adir al Proyecto'.", "Su lista completa del proyecto y los totales se muestran en la parte inferior.", "Use los botones 'Copiar' o 'Imprimir' para un resumen port√°til."]},
        zh: { app_title: "‰∏ì‰∏öÊ∑∑ÂáùÂúüËÆ°ÁÆóÂô®", settings_title: "È°πÁõÆËÆæÁΩÆ‰∏éÊàêÊú¨", waste_factor: "ÊçüËÄóÁ≥ªÊï∞", cost_yard: "ÊØèÁ´ãÊñπÁ†ÅÊàêÊú¨", cost_80lb: "ÊØè80Á£ÖË¢ãÊàêÊú¨", cost_60lb: "ÊØè60Á£ÖË¢ãÊàêÊú¨", clear_button: "Ê∏ÖÈô§È°πÁõÆ", print_button: "ÊâìÂç∞", copy_button: "Â§çÂà∂ÊñáÊú¨", copied_button: "Â∑≤Â§çÂà∂!", slab_footing_title: "Êùø/Âü∫Á°Ä", column_title: "ÂúÜÊü±/Â≠î", circ_slab_title: "ÂúÜÂΩ¢Êùø", stairs_title: "Ê•ºÊ¢Ø", tube_bell_title: "Â∏¶ÈíüËÑöÁöÑÁÆ°", trapezoid_footing_title: "Ê¢ØÂΩ¢Âü∫Á°Ä", project_title: "È°πÁõÆÊëòË¶Å", instructions_title: "Â¶Ç‰Ωï‰ΩøÁî®", calculate_button: "ËÆ°ÁÆó", total_needed: "ÂçïÈ°πÊÄªËÆ°", grand_total: "ÊÄªËÆ°", item_name: "È°πÁõÆÂêçÁß∞(ÂèØÈÄâ)", cubic_yards: "Á´ãÊñπÁ†Å", bags80: "80Á£ÖË¢ã", bags60: "60Á£ÖË¢ã", add_to_project: "Ê∑ªÂä†Âà∞È°πÁõÆ", running_total_text: (n) => `È°πÁõÆ: ${n} È°π`, length: "ÈïøÂ∫¶", width: "ÂÆΩÂ∫¶", thickness: "ÂéöÂ∫¶", diameter: "Áõ¥ÂæÑ", depth_height: "Ê∑±Â∫¶/È´òÂ∫¶", num_steps: "Âè∞Èò∂Êï∞", tread_depth: "Ë∏èÊùøÊ∑±Â∫¶", riser_height: "Ë∏¢ÊùøÈ´òÂ∫¶", stair_width: "Ê•ºÊ¢ØÂÆΩÂ∫¶", waist_thick: "Ê¢ØËÖ∞ÂéöÂ∫¶", tube_diameter: "ÁÆ°Áõ¥ÂæÑ", bell_diameter: "ÈíüËÑöÁõ¥ÂæÑ", bell_thickness: "ÈíüËÑöÂéöÂ∫¶", top_width: "È°∂ÈÉ®ÂÆΩÂ∫¶", bottom_width: "Â∫ïÈÉ®ÂÆΩÂ∫¶", feet: "Ëã±Â∞∫", inches: "Ëã±ÂØ∏", project_empty: "ÊÇ®ÁöÑÈ°πÁõÆÊòØÁ©∫ÁöÑ„ÄÇ", error_invalid_input: "ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊ≠£Êï∞„ÄÇ", cost: "ÊàêÊú¨", instructions: [ "Âú®‚ÄúËÆæÁΩÆ‚ÄùÈù¢Êùø‰∏≠Ë∞ÉÊï¥ÊçüËÄóÁ≥ªÊï∞ÂíåÊùêÊñôÊàêÊú¨„ÄÇ", "ÂçïÂáªÂõæÊ†á‰∏∫ÊÇ®ÁöÑÂΩ¢Áä∂ÈÄâÊã©ËÆ°ÁÆóÂô®„ÄÇ", "ËæìÂÖ•Â∞∫ÂØ∏„ÄÇÊÇ®ÂèØ‰ª•ÂêåÊó∂‰ΩøÁî®Ëã±Â∞∫ÂíåËã±ÂØ∏Â≠óÊÆµ„ÄÇ", "ÂçïÂáª‚ÄúËÆ°ÁÆó‚Äù‰ª•Êü•ÁúãËØ•Âçï‰ª∂ÊâÄÈúÄÁöÑÊ∑∑ÂáùÂúü„ÄÇ", "‰∏∫ËØ•‰ª∂ÂëΩÂêçÔºà‰æãÂ¶Ç‚ÄúÂ∫≠Èô¢‚ÄùÔºâÂπ∂ÂçïÂáª‚ÄúÊ∑ªÂä†Âà∞È°πÁõÆ‚Äù„ÄÇ", "ÊÇ®ÁöÑÂÆåÊï¥È°πÁõÆÂàóË°®ÂíåÊÄªËÆ°ÊòæÁ§∫Âú®Â∫ïÈÉ®„ÄÇ", "‰ΩøÁî®‚ÄúÂ§çÂà∂‚ÄùÊàñ‚ÄúÊâìÂç∞‚ÄùÊåâÈíÆËé∑Âèñ‰æøÊê∫ÂºèÊëòË¶Å„ÄÇ" ]},
        hi: { app_title: "‡§™‡•ç‡§∞‡•ã ‡§ï‡§Ç‡§ï‡•ç‡§∞‡•Ä‡§ü ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞", settings_title: "‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§î‡§∞ ‡§≤‡§æ‡§ó‡§§", waste_factor: "‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§ï‡§æ‡§∞‡§ï", cost_yard: "‡§™‡•ç‡§∞‡§§‡§ø yd¬≥ ‡§≤‡§æ‡§ó‡§§ (‡§ü‡•ç‡§∞‡§ï)", cost_80lb: "‡§™‡•ç‡§∞‡§§‡§ø 80lb ‡§¨‡•à‡§ó ‡§≤‡§æ‡§ó‡§§", cost_60lb: "‡§™‡•ç‡§∞‡§§‡§ø 60lb ‡§¨‡•à‡§ó ‡§≤‡§æ‡§ó‡§§", clear_button: "‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç", print_button: "‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç", copy_button: "‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç", copied_button: "‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!", slab_footing_title: "‡§∏‡•ç‡§≤‡•à‡§¨ / ‡§´‡•Å‡§ü‡§ø‡§Ç‡§ó", column_title: "‡§ï‡•â‡§≤‡§Æ / ‡§™‡•ã‡§∏‡•ç‡§ü ‡§π‡•ã‡§≤", circ_slab_title: "‡§ó‡•ã‡§≤ ‡§∏‡•ç‡§≤‡•à‡§¨", stairs_title: "‡§∏‡•Ä‡§¢‡§º‡§ø‡§Ø‡§æ‡§Å", tube_bell_title: "‡§ü‡•ç‡§Ø‡•Ç‡§¨ ‡§î‡§∞ ‡§¨‡•á‡§≤ ‡§´‡•Å‡§ü‡§ø‡§Ç‡§ó", trapezoid_footing_title: "‡§ü‡•ç‡§∞‡•á‡§™‡•á‡§ú‡§º‡•â‡§á‡§° ‡§´‡•Å‡§ü‡§ø‡§Ç‡§ó", project_title: "‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂", instructions_title: "‡§ï‡•à‡§∏‡•á ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç", calculate_button: "‡§ó‡§£‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç", total_needed: "‡§è‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§ï‡•Å‡§≤", grand_total: "‡§ï‡•Å‡§≤ ‡§Ø‡•ã‡§ó", item_name: "‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)", cubic_yards: "‡§ò‡§® ‡§ó‡§ú", bags80: "80lb ‡§¨‡•à‡§ó", bags60: "60lb ‡§¨‡•à‡§ó", add_to_project: "‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç", running_total_text: (n) => `‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü: ${n} ‡§Ü‡§á‡§ü‡§Æ`, length: "‡§≤‡§Ç‡§¨‡§æ‡§à", width: "‡§ö‡•å‡§°‡§º‡§æ‡§à", thickness: "‡§Æ‡•ã‡§ü‡§æ‡§à", diameter: "‡§µ‡•ç‡§Ø‡§æ‡§∏", depth_height: "‡§ó‡§π‡§∞‡§æ‡§à / ‡§ä‡§Ç‡§ö‡§æ‡§à", num_steps: "‡§∏‡•Ä‡§¢‡§º‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ", tread_depth: "‡§ü‡•ç‡§∞‡•á‡§° ‡§ï‡•Ä ‡§ó‡§π‡§∞‡§æ‡§à", riser_height: "‡§∞‡§ø‡§∏‡§∞ ‡§ï‡•Ä ‡§ä‡§Ç‡§ö‡§æ‡§à", stair_width: "‡§∏‡•Ä‡§¢‡§º‡•Ä ‡§ï‡•Ä ‡§ö‡•å‡§°‡§º‡§æ‡§à", waist_thick: "‡§ï‡§Æ‡§∞/‡§∏‡•ç‡§≤‡•à‡§¨ ‡§ï‡•Ä ‡§Æ‡•ã‡§ü‡§æ‡§à", tube_diameter: "‡§ü‡•ç‡§Ø‡•Ç‡§¨ ‡§ï‡§æ ‡§µ‡•ç‡§Ø‡§æ‡§∏", bell_diameter: "‡§¨‡•á‡§≤ ‡§ï‡§æ ‡§µ‡•ç‡§Ø‡§æ‡§∏", bell_thickness: "‡§¨‡•á‡§≤ ‡§ï‡•Ä ‡§Æ‡•ã‡§ü‡§æ‡§à", top_width: "‡§ä‡§™‡§∞‡•Ä ‡§ö‡•å‡§°‡§º‡§æ‡§à", bottom_width: "‡§®‡§ø‡§ö‡§≤‡•Ä ‡§ö‡•å‡§°‡§º‡§æ‡§à", feet: "‡§´‡•Ä‡§ü", inches: "‡§á‡§Ç‡§ö", project_empty: "‡§Ü‡§™‡§ï‡§æ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à‡•§ ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞ ‡§∏‡•á ‡§Ü‡§á‡§ü‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§", error_invalid_input: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡§æ‡§®‡•ç‡§Ø, ‡§∏‡§ï‡§æ‡§∞‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§è‡§Å ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§", cost: "‡§≤‡§æ‡§ó‡§§", instructions: [ "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§™‡•à‡§®‡§≤ ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§∂‡§ø‡§∑‡•ç‡§ü ‡§ï‡§æ‡§∞‡§ï ‡§î‡§∞ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§≤‡§æ‡§ó‡§§ ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§", "‡§Ö‡§™‡§®‡•á ‡§Ü‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞ ‡§ö‡•Å‡§®‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§Ü‡§á‡§ï‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á, ‡§∏‡•ç‡§≤‡•à‡§¨, ‡§ï‡•â‡§≤‡§Æ)‡•§", "‡§Æ‡§æ‡§™ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ü‡§™ ‡§≤‡§Ç‡§¨‡§æ‡§à/‡§ö‡•å‡§°‡§º‡§æ‡§à/‡§ó‡§π‡§∞‡§æ‡§à ‡§ï‡•á ‡§≤‡§ø‡§è ‡§´‡•Ä‡§ü ‡§î‡§∞ ‡§á‡§Ç‡§ö ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§", "‡§â‡§∏ ‡§è‡§ï ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡§Ç‡§ï‡•ç‡§∞‡•Ä‡§ü ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è '‡§ó‡§£‡§®‡§æ ‡§ï‡§∞‡•á‡§Ç' ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§", "‡§Ü‡§á‡§ü‡§Æ ‡§ï‡•ã ‡§è‡§ï ‡§®‡§æ‡§Æ ‡§¶‡•á‡§Ç (‡§ú‡•à‡§∏‡•á '‡§Ü‡§Ç‡§ó‡§®') ‡§î‡§∞ '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç' ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§", "‡§Ü‡§™‡§ï‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§∏‡•Ç‡§ö‡•Ä ‡§î‡§∞ ‡§ï‡•Å‡§≤ ‡§Ø‡•ã‡§ó ‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§ñ‡§æ‡§è ‡§ó‡§è ‡§π‡•à‡§Ç‡•§", "‡§è‡§ï ‡§™‡•ã‡§∞‡•ç‡§ü‡•á‡§¨‡§≤ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ ‡§ï‡•á ‡§≤‡§ø‡§è '‡§ï‡•â‡§™‡•Ä' ‡§Ø‡§æ '‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü' ‡§¨‡§ü‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§" ]}
    };

    const calculators = {
        'slab-footing': { titleKey: 'slab_footing_title', icon: `<svg viewBox="0 0 24 24"><path d="M20.7,5.3l-2.1-2.1c-0.2-0.2-0.5-0.2-0.7,0L3.3,17.7C3.1,17.9,3,18.2,3,18.5V21h2.5c0.3,0,0.6-0.1,0.8-0.3l14.4-14.4 C20.9,6,20.9,5.5,20.7,5.3z M6.6,19H5v-1.6l10-10l1.6,1.6L6.6,19z"/></svg>`, inputs: [{name: 'length', type: 'ft-in'}, {name: 'width', type: 'ft-in'}, {name: 'thickness', type: 'in'}], calculate: v => getVal(v, 'length') * getVal(v, 'width') * (getVal(v, 'thickness')/12) },
        'circ-slab': { titleKey: 'circ_slab_title', icon: `<svg viewBox="0 0 24 24"><path d="M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M12,20c-4.4,0-8-3.6-8-8s3.6-8,8-8s8,3.6,8,8 S16.4,20,12,20z"/></svg>`, inputs: [{name: 'diameter', type: 'ft-in'}, {name: 'thickness', type: 'in'}], calculate: v => { const r = getVal(v, 'diameter')/2; return PI*r*r*(getVal(v, 'thickness')/12); }},
        'column': { titleKey: 'column_title', icon: `<svg viewBox="0 0 24 24"><path d="M14,2H10C9.4,2,9,2.4,9,3v18c0,0.6,0.4,1,1,1h4c0.6,0,1-0.4,1-1V3C15,2.4,14.6,2,14,2z"/></svg>`, inputs: [{name: 'diameter', type: 'in'}, {name: 'depth_height', type: 'ft-in'}], calculate: v => { const r = getVal(v, 'diameter')/2/12; return PI*r*r*getVal(v,'depth_height'); }},
        'stairs': { titleKey: 'stairs_title', icon: `<svg viewBox="0 0 24 24"><path d="M21,4H3C2.4,4,2,4.4,2,5v2c0,0.6,0.4,1,1,1h4v3H3c-0.6,0-1,0.4-1,1v2c0,0.6,0.4,1,1,1h4v3H3c-0.6,0-1,0.4-1,1v2 c0,0.6,0.4,1,1,1h18c0.6,0,1-0.4,1-1V5C22,4.4,21.6,4,21,4z"/></svg>`, layout: '2-col', inputs: [{name: 'num_steps', type: 'num'}, {name: 'stair_width', type: 'ft-in'}, {name: 'tread_depth', type: 'in'}, {name: 'riser_height', type: 'in'}, {name: 'waist_thick', type: 'in'}], calculate: v => { const n=getVal(v,'num_steps'), t=getVal(v,'tread_depth')/12, r=getVal(v,'riser_height')/12, w=getVal(v,'stair_width'), a=getVal(v,'waist_thick')/12; const triangularVolume=n*(.5*t*r*w); const slabLength=Math.sqrt(Math.pow(n*t,2)+Math.pow(n*r,2)); return triangularVolume+(slabLength*w*a); }},
        'tube-bell': { titleKey: 'tube_bell_title', icon: `<svg viewBox="0 0 24 24"><path d="M14,2h-4C9.4,2,9,2.4,9,3v12.1c-1.2,0.4-2,1.5-2,2.9c0,1.7,1.3,3,3,3s3-1.3,3-3c0-1.4-0.8-2.5-2-2.9V3 C15,2.4,14.6,2,14,2z M12,20c-0.6,0-1-0.4-1-1s0.4-1,1-1s1,0.4,1,1S12.6,20,12,20z"/></svg>`, inputs: [{name: 'tube_diameter', type: 'in'}, {name: 'depth_height', type: 'ft-in'}, {name: 'bell_diameter', type: 'in'}, {name: 'bell_thickness', type: 'in'}], calculate: v => { const tubeR = getVal(v, 'tube_diameter')/2/12; const bellR = getVal(v, 'bell_diameter')/2/12; const bellH = getVal(v, 'bell_thickness')/12; const tubeH = getVal(v, 'depth_height'); const volTube = PI * tubeR * tubeR * tubeH; const volBell = PI * bellH / 3 * (bellR*bellR + bellR*tubeR + tubeR*tubeR); return volTube + volBell; }},
        'trapezoid-footing': { titleKey: 'trapezoid_footing_title', icon: `<svg viewBox="0 0 24 24"><path d="M2.2,6h19.6c0.4,0,0.7-0.5,0.5-0.8l-2.8-5C19.3,0,18.9,0,18.7,0H5.3 C5.1,0,4.7,0.2,4.5,0.5l-2.8,5C1.5,5.5,1.8,6,2.2,6z M4,19c-1.1,0-2-0.9-2-2V8h20v9c0,1.1-0.9,2-2,2H4z"/></svg>`, inputs: [{name: 'length', type: 'ft-in'}, {name: 'top_width', type: 'in'}, {name: 'bottom_width', type: 'ft-in'}, {name: 'depth_height', type: 'in'}], calculate: v => getVal(v,'length') * (getVal(v,'depth_height')/12) * ( (getVal(v,'top_width')/12 + getVal(v,'bottom_width')) / 2) }
    };
    
    // --- STATE MANAGEMENT ---
    function saveState() { localStorage.setItem('concreteCalculatorState', JSON.stringify(state)); }
    function loadState() {
        const savedState = localStorage.getItem('concreteCalculatorState');
        if (savedState) {
            const parsedState = JSON.parse(savedState);
            state = { ...state, ...parsedState, settings: { ...state.settings, ...parsedState.settings }, ui: { ...state.ui, ...parsedState.ui } };
        }
    }
    
    // --- INITIALIZATION ---
    function initializeApp() {
        loadState();
        const template = document.getElementById('calculator-view-template');
        
        Object.entries(calculators).forEach(([id, config]) => {
            DOM.navGrid.innerHTML += `<button class="nav-button" data-view-id="${id}">${config.icon}<span data-translate-key="${config.titleKey}"></span></button>`;
            const viewClone = template.content.cloneNode(true).firstElementChild;
            viewClone.id = id;
            const inputsContainer = viewClone.querySelector('.form-inputs');
            
            const inputsHTML = config.inputs.map(i => {
                const label = `<span data-translate-key="${i.name}"></span>`;
                let inputGroup;
                if (i.type === 'ft-in') {
                    inputGroup = `<div class="input-group feet-inches"><input type="number" name="${i.name}-ft" min="0" step="1"><span class="unit" data-translate-key-unit="feet"></span><input type="number" name="${i.name}-in" min="0" max="11.99" step="any"><span class="unit" data-translate-key-unit="inches"></span></div>`;
                } else if (i.type === 'in') {
                    inputGroup = `<div class="input-group"><input type="number" name="${i.name}" min="0" step="any"><span class="unit" data-translate-key-unit="inches"></span></div>`;
                } else { // 'num'
                    inputGroup = `<div class="input-group"><input type="number" name="${i.name}" min="0" step="1"></div>`;
                }
                return `<div class="form-row">${label}${inputGroup}</div>`;
            }).join('');

            if(config.layout === '2-col') {
                inputsContainer.classList.add('form-row-2-col');
            }
            inputsContainer.innerHTML = inputsHTML;
            DOM.viewContainer.appendChild(viewClone);

            viewClone.querySelector('.calculate-button').addEventListener('click', () => handleCalculate(viewClone, config, id));
        });

        attachEventListeners(); updateSettingsUI(); applyTheme();
        renderProjectView(); showView(state.ui.activeView); setLanguage(state.lang);
    }

    function attachEventListeners() {
        DOM.navGrid.querySelectorAll('.nav-button').forEach(btn => btn.addEventListener('click', e => showView(e.currentTarget.dataset.viewId)));
        document.querySelectorAll('.lang-button').forEach(btn => btn.addEventListener('click', e => setLanguage(e.target.dataset.lang)));
        DOM.instructionsBtn.addEventListener('click', () => DOM.instructionsModal.style.display = 'flex');
        DOM.modalClose.addEventListener('click', () => DOM.instructionsModal.style.display = 'none');
        DOM.themeToggle.addEventListener('click', toggleTheme);
        [DOM.wasteFactorInput, DOM.costYardInput, DOM.cost80lbInput, DOM.cost60lbInput].forEach(input => {
            input.addEventListener('change', handleSettingsChange);
        });
    }

    function showView(viewId) {
        if (!viewId || !document.getElementById(viewId)) viewId = 'slab-footing';
        state.ui.activeView = viewId;
        document.querySelectorAll('.app-view').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        document.querySelectorAll('.nav-button').forEach(btn => btn.classList.toggle('active', btn.dataset.viewId === viewId));
        saveState();
    }
    
    function setLanguage(lang) {
        state.lang = lang;
        const dict = { ...translations.en, ...(translations[lang] || {}) };
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.dataset.translateKey;
            if (dict[key] && typeof dict[key] !== 'function') el.textContent = dict[key];
        });
        document.querySelectorAll('[data-translate-key-unit]').forEach(el => el.textContent = dict[el.dataset.translateKeyUnit]);
        const instructionList = document.querySelector('[data-translate-list="instructions"]');
        if(instructionList) {
            instructionList.innerHTML = (dict.instructions || []).map(item => `<li>${item}</li>`).join('');
        }
        document.querySelectorAll('.lang-button').forEach(btn => btn.classList.toggle('selected', btn.dataset.lang === lang));
        updateRunningTotals(); saveState();
    }

    function applyTheme() {
        document.documentElement.classList.toggle('dark-mode', state.ui.isDark);
        DOM.themeToggle.textContent = state.ui.isDark ? '‚òÄÔ∏è' : 'üåô';
    }
    function toggleTheme() { state.ui.isDark = !state.ui.isDark; applyTheme(); saveState(); }
    
    function updateSettingsUI() {
        DOM.wasteFactorInput.value = state.settings.waste;
        DOM.costYardInput.value = state.settings.costYard;
        DOM.cost80lbInput.value = state.settings.cost80lb;
        DOM.cost60lbInput.value = state.settings.cost60lb;
    }

    function handleCalculate(view, config, id) {
        const errorEl = view.querySelector('.error-message');
        errorEl.textContent = '';
        const volumeFt3 = config.calculate(view);

        if (isNaN(volumeFt3) || volumeFt3 <= 0) {
            errorEl.textContent = (translations[state.lang] || translations.en).error_invalid_input;
            return;
        }

        const volumeWithWaste = volumeFt3 * (1 + (state.settings.waste / 100));
        const defaultName = (translations[state.lang] || translations.en)[config.titleKey];
        state.latestCalcResults[id] = { name: defaultName, volume: volumeWithWaste };
        
        const resultsContainer = view.querySelector('.results-container');
        resultsContainer.innerHTML = createResultsHTML(volumeWithWaste, 'total_needed', defaultName);
        resultsContainer.style.display = 'block';
        
        const addBtn = resultsContainer.querySelector('.add-to-project-button');
        if(addBtn) addBtn.addEventListener('click', () => handleAddToProject(view, id));
        setLanguage(state.lang);
    }
    
    function handleAddToProject(view, id) {
        if (!state.latestCalcResults[id]) return;
        const nameInput = view.querySelector('.item-name-input');
        const itemName = nameInput && nameInput.value.trim() !== '' ? nameInput.value.trim() : state.latestCalcResults[id].name;
        const itemVolume = state.latestCalcResults[id].volume;
        const itemCost = (itemVolume / CUBIC_FEET_IN_YARD) * state.settings.costYard;
        
        state.projectItems.push({ 
            id: Date.now(), 
            name: itemName, 
            volume: itemVolume, 
            cost: itemCost
        });
        delete state.latestCalcResults[id];
        
        view.querySelectorAll('input[type="number"]').forEach(input => input.value = '');
        view.querySelector('.results-container').style.display = 'none';
        
        updateRunningTotals(); renderProjectView(); saveState();
    }
    
    function handleSettingsChange(e) {
        const id = e.target.id;
        const value = parseFloat(e.target.value);
        if (isNaN(value) && value !== 0) return;

        if (id === 'waste-factor') state.settings.waste = value;
        else if (id === 'cost-yard') state.settings.costYard = value;
        else if (id === 'cost-80lb') state.settings.cost80lb = value;
        else if (id === 'cost-60lb') state.settings.cost60lb = value;
        
        saveState(); renderProjectView();
    }

    function renderProjectView() {
        let content = `<div id="project-summary"><h2 data-translate-key="project_title"></h2><ul>`;
        if (state.projectItems.length === 0) {
            content += `<li data-translate-key="project_empty"></li></ul></div>`;
        } else {
            const totalVolume = state.projectItems.reduce((acc, item) => acc + item.volume, 0);
            state.projectItems.forEach(item => {
                const itemYards = (item.volume / CUBIC_FEET_IN_YARD).toFixed(2);
                content += `<li>
                                <div class="project-item-details">
                                    <span class="project-item-name">${item.name}</span>
                                </div>
                                <div class="project-item-cost">
                                    $${item.cost.toFixed(2)}
                                    <div class="volume">${itemYards} yd¬≥</div>
                                </div>
                                <button class="remove-item-btn no-print" data-id="${item.id}">√ó</button>
                            </li>`;
            });
            content += `</ul>${createResultsHTML(totalVolume, 'grand_total')}`;
            // FIXED THIS LINE: Added data-translate-key attributes
            content += `<div class="project-actions no-print">
                            <button id="copy-project-btn" class="action-button" style="background-color: var(--warning-color); color: #333;" data-translate-key="copy_button"></button>
                            <button id="print-project-btn" class="action-button" data-translate-key="print_button"></button>
                            <button id="clear-project-btn" class="action-button" style="background-color: var(--danger-color);" data-translate-key="clear_button"></button>
                        </div></div>`;
        }
        DOM.projectSummaryContainer.innerHTML = content;
        
        DOM.projectSummaryContainer.querySelector('#clear-project-btn')?.addEventListener('click', clearProject);
        DOM.projectSummaryContainer.querySelector('#print-project-btn')?.addEventListener('click', () => window.print());
        DOM.projectSummaryContainer.querySelector('#copy-project-btn')?.addEventListener('click', handleCopyProject);
        DOM.projectSummaryContainer.querySelectorAll('.remove-item-btn').forEach(btn => btn.addEventListener('click', (e) => {
            state.projectItems = state.projectItems.filter(i => i.id !== parseInt(e.target.dataset.id));
            updateRunningTotals(); renderProjectView(); saveState();
        }));
        setLanguage(state.lang);
    }
    
    function createResultsHTML(volumeFt3, titleKey, itemName) {
        const yards = volumeFt3 / CUBIC_FEET_IN_YARD;
        const bags80 = Math.ceil(volumeFt3 / BAG_80LB_YIELD);
        const bags60 = Math.ceil(volumeFt3 / BAG_60LB_YIELD);
        const costYard = yards * state.settings.costYard;
        const cost80 = bags80 * state.settings.cost80lb;
        const cost60 = bags60 * state.settings.cost60lb;
        const t = (key) => (translations[state.lang] || translations.en)[key];
        const nameField = itemName ? `<div class="item-name-group"><input type="text" class="item-name-input" value="${itemName}" placeholder="${t('item_name')}"></div>` : '';
        const addButton = itemName ? `<button class="action-button add-to-project-button" data-translate-key="add_to_project"></button>` : '';

        return `<h3 data-translate-key="${titleKey}"></h3>
            <div class="result-item"><span class="value">${yards.toFixed(2)}</span> <span data-translate-key="cubic_yards"></span><div class="cost-display">${t('cost')}: $${costYard.toFixed(2)}</div></div>
            <div class="result-split">
                <div class="result-item"><span class="value">${bags80}</span> <span data-translate-key="bags80"></span><div class="cost-display">${t('cost')}: $${cost80.toFixed(2)}</div></div>
                <div class="result-item"><span class="value">${bags60}</span> <span data-translate-key="bags60"></span><div class="cost-display">${t('cost')}: $${cost60.toFixed(2)}</div></div>
            </div>${nameField}${addButton}`;
    }

    function clearProject() { 
        if (confirm('Are you sure you want to clear the entire project? This cannot be undone.')) {
            state.projectItems = []; updateRunningTotals(); renderProjectView(); saveState();
        }
    }
    
    function handleCopyProject(e) {
        const btn = e.target;
        const t = (key) => (translations[state.lang] || translations.en)[key];
        let text = `${t('project_title')}\n========================\n\n`;
        state.projectItems.forEach(item => {
            text += `ITEM: ${item.name}\n`;
            text += ` - ${(item.volume / CUBIC_FEET_IN_YARD).toFixed(2)} yd¬≥  (${t('cost')}: $${item.cost.toFixed(2)})\n\n`;
        });
        const totalVolume = state.projectItems.reduce((acc, item) => acc + item.volume, 0);
        const totalYards = totalVolume / CUBIC_FEET_IN_YARD;
        const totalBags80 = Math.ceil(totalVolume / BAG_80LB_YIELD);
        const totalBags60 = Math.ceil(totalVolume / BAG_60LB_YIELD);
        text += `${t('grand_total').toUpperCase()}\n------------------------\n`;
        text += `${t('cubic_yards')}: ${totalYards.toFixed(2)} (${t('cost')}: $${(totalYards * state.settings.costYard).toFixed(2)})\n`;
        text += `${t('bags80')}: ${totalBags80} (${t('cost')}: $${(totalBags80 * state.settings.cost80lb).toFixed(2)})\n`;
        text += `${t('bags60')}: ${totalBags60} (${t('cost')}: $${(totalBags60 * state.settings.cost60lb).toFixed(2)})\n`;
        text += `(Includes a ${state.settings.waste}% ${t('waste_factor')})\n`;

        navigator.clipboard.writeText(text).then(() => {
            // FIXED THIS LOGIC: Store original text before changing it.
            const originalText = btn.textContent;
            btn.textContent = t('copied_button');
            setTimeout(() => { btn.textContent = originalText; }, 2000);
        });
    }

    function updateRunningTotals() {
        if (state.projectItems.length === 0) { DOM.runningTotalsBar.style.display = 'none'; return; }
        DOM.runningTotalsBar.style.display = 'flex';
        const totalVolume = state.projectItems.reduce((acc, item) => acc + item.volume, 0);
        DOM.runningTotalsBar.querySelector('#running-yards').textContent = (totalVolume / CUBIC_FEET_IN_YARD).toFixed(2);
        const textFunc = (translations[state.lang] || translations.en).running_total_text;
        DOM.runningTotalsBar.querySelector('#running-totals-text').textContent = textFunc(state.projectItems.length);
    }
    
    const getVal = (v, n) => {
        const ft_in = v.querySelector(`[name="${n}-ft"]`);
        if (ft_in) {
            const ft = parseFloat(ft_in.value) || 0;
            const inch = parseFloat(v.querySelector(`[name="${n}-in"]`).value) || 0;
            return ft + (inch / 12);
        }
        return parseFloat(v.querySelector(`[name="${n}"]`).value) || 0;
    };
    
    initializeApp();
});
</script>
</body>
</html>
